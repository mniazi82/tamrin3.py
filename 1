import numpy as np
from sklearn.datasets import load_digits
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier
from sklearn.naive_bayes import GaussianNB
from sklearn.dummy import DummyClassifier
from sklearn.metrics import accuracy_score

def load_and_split_data():
    """
    بارگذاری دیتاست Digits و تقسیم آن به دو بخش آموزش و تست.
    """
    digits = load_digits()
    X = digits.data
    y = digits.target
    # تقسیم داده‌ها: ۸۰ درصد آموزش، ۲۰ درصد تست
    return train_test_split(X, y, test_size=0.2, random_state=42)

def train_and_evaluate(model, X_train, X_test, y_train, y_test, model_name):
    """
    آموزش مدل و محاسبه دقت آن روی داده‌های تست.
    """
    model.fit(X_train, y_train)
    predictions = model.predict(X_test)
    acc = accuracy_score(y_test, predictions)
    
    print(f"--- {model_name} ---")
    print(f"دقت مدل (Accuracy): {acc:.2%}")
    return acc

def main():
    # ۱. آماده‌سازی داده‌ها
    X_train, X_test, y_train, y_test = load_and_split_data()
    
    # ۲. تعریف مدل‌ها
    models = {
        "جنگل تصادفی (Random Forest)": RandomForestClassifier(n_estimators=100, random_state=42),
        "بیز ساده (Naive Bayes)": GaussianNB(),
        "طبقه‌بند کاملاً تصادفی (شانسی)": DummyClassifier(strategy='uniform', random_state=42)
    }
    
    # ۳. آموزش و مقایسه
    results = {}
    print("نتایج اجرای مدل‌ها:\n")
    for name, model in models.items():
        results[name] = train_and_evaluate(model, X_train, X_test, y_train, y_test, name)
        print("-" * 30)
    
    # ۴. تحلیل نهایی و پاسخ به سوالات
    rf_acc = results["جنگل تصادفی (Random Forest)"]
    nb_acc = results["بیز ساده (Naive Bayes)"]
    rnd_acc = results["طبقه‌بند کاملاً تصادفی (شانسی)"]
    
    print("\n=== تحلیل مقایسه‌ای ===")
    print(f"بهبود عملکرد جنگل تصادفی نسبت به بیز: {rf_acc - nb_acc:.2%} +")
    print(f"بهبود عملکرد بیز نسبت به حالت تصادفی: {nb_acc - rnd_acc:.2%} +")

    # ۵. محاسبه نظری (سوال ۳ تمرین)
    n_classes = 10  # اعداد ۰ تا ۹
    theoretical_acc = 1 / n_classes
    print(f"\n=== پاسخ نظری (سوال ۳) ===")
    print(f"تعداد کلاس‌ها: {n_classes}")
    print(f"دقت نظری یک طبقه‌بند کاملاً تصادفی (1/N): {theoretical_acc:.2%}")

if __name__ == "__main__":
    main()
